<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Gastos</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4f46e5">
    <link rel="icon" type="image/png" sizes="32x32" href="icon-192x192.png">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f3f4f6;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #1f2937;
            font-size: 2rem;
            margin-bottom: 1.5rem;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        h2 {
            text-align: center;
            color: #374151;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .item-list {
            margin-bottom: 1rem;
        }
        .item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        input[type="text"], input[type="number"] {
            width: calc(50% - 5px);
            padding: 5px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
        }
        button {
            width: 100%;
            padding: 10px;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #agregar-ingreso {
            background-color: #10B981; /* Verde */
        }
        #agregar-ingreso:hover {
            background-color: #059669;
        }
        #agregar-gasto {
            background-color: #EF4444; /* Rojo */
        }
        #agregar-gasto:hover {
            background-color: #DC2626;
        }
        .total {
            margin-top: 1rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }
        #balance {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
        }
        .balance-card h2 {
            background-color: #3B82F6; /* Azul */
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin: -20px -20px 20px -20px;
        }
        @media (max-width: 640px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CONTROL DE GASTOS</h1>
        
        <div class="grid">
            <div class="card">
                <h2>Ingresos</h2>
                <div id="ingresos-list" class="item-list">
                    <div class="item">
                        <input type="text" placeholder="Descripción" class="descripcion-ingreso">
                        <input type="number" placeholder="Valor" class="valor-ingreso">
                    </div>
                </div>
                <button id="agregar-ingreso">Agregar</button>
                <div class="total">
                    <span>TOTAL INGRESOS</span>
                    <span id="total-ingresos">$0</span>
                </div>
            </div>
            
            <div class="card">
                <h2>Gastos</h2>
                <div id="gastos-list" class="item-list">
                    <div class="item">
                        <input type="text" placeholder="Descripción" class="descripcion-gasto">
                        <input type="number" placeholder="Valor" class="valor-gasto">
                    </div>
                </div>
                <button id="agregar-gasto">Agregar</button>
                <div class="total">
                    <span>TOTAL GASTOS</span>
                    <span id="total-gastos">$0</span>
                </div>
            </div>
        </div>
        
        <div class="card balance-card" style="margin-top: 20px;">
            <h2>BALANCE</h2>
            <p id="balance">$0</p>
        </div>
    </div>

    <script>
        let datos = {
            ingresos: [{descripcion: '', valor: 0}],
            gastos: [{descripcion: '', valor: 0}]
        };

        function cargarDatos() {
            const datosGuardados = localStorage.getItem('controlGastos');
            if (datosGuardados) {
                datos = JSON.parse(datosGuardados);
            }
            renderizarItems('ingresos-list', datos.ingresos);
            renderizarItems('gastos-list', datos.gastos);
            actualizarTotales();
        }

        function guardarDatos() {
            localStorage.setItem('controlGastos', JSON.stringify(datos));
        }

        function renderizarItems(listId, items) {
            const list = document.getElementById(listId);
            list.innerHTML = '';
            items.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `
                    <input type="text" value="${item.descripcion}" placeholder="Descripción" class="descripcion-${listId === 'ingresos-list' ? 'ingreso' : 'gasto'}">
                    <input type="number" value="${item.valor}" placeholder="Valor" class="valor-${listId === 'ingresos-list' ? 'ingreso' : 'gasto'}">
                `;
                list.appendChild(div);

                const valorInput = div.querySelector('input[type="number"]');
                valorInput.addEventListener('change', () => {
                    item.valor = parseFloat(valorInput.value) || 0;
                    valorInput.value = item.valor; // Asegura que el valor sea un número
                    actualizarTotales();
                    guardarDatos();
                });

                div.querySelector('input[type="text"]').addEventListener('input', () => {
                    item.descripcion = div.querySelector('input[type="text"]').value;
                    guardarDatos();
                });
            });
        }


        // Función para formatear números
        function formatearNumero(numero) {
            return '$' + numero.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        function actualizarTotales() {
            let totalIngresos = datos.ingresos.reduce((sum, item) => sum + item.valor, 0);
            let totalGastos = datos.gastos.reduce((sum, item) => sum + item.valor, 0);

            document.getElementById('total-ingresos').textContent = formatearNumero(totalIngresos);
            document.getElementById('total-gastos').textContent = formatearNumero(totalGastos);
            
            const balance = totalIngresos - totalGastos;
            document.getElementById('balance').textContent = formatearNumero(balance);
            document.getElementById('balance').style.color = balance >= 0 ? 'green' : 'red';
        }


        function agregarItem(tipo) {
            datos[tipo].push({ descripcion: '', valor: 0 });
            renderizarItems(`${tipo}-list`, datos[tipo]);
            actualizarTotales();
            guardarDatos();
        }


        // Asegúrate de llamar a cargarDatos() al inicio para cargar los campos predeterminados
        document.addEventListener('DOMContentLoaded', cargarDatos);

        document.getElementById('agregar-ingreso').addEventListener('click', () => agregarItem('ingresos'));
        document.getElementById('agregar-gasto').addEventListener('click', () => agregarItem('gastos'));

        cargarDatos();

        // Registrar el Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registrado con éxito:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Falló el registro del Service Worker:', error);
                    });
            });
        }
    </script>
</body>
</html>